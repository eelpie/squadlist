#parse('includes/head.vm')
#navTabs('My outings')

<div class="row-fluid">

	#outingsNav('/')
	
	<div class="span10">
		<h3>$heading</h3>				
		<p>Upcoming outings for your squads ($squadNamesHelper.list($member.squads))</p>		
		<hr/>
			
		#if($outings.isEmpty()) 
			<h4>No current outings</h4>
			<p>There are no outings scheduled for your squads between $dateFormatter.dayMonthYear($startDate) and $dateFormatter.dayMonthYear($endDate).</p>		
		#end		
		
		<form>
		#foreach($outing in $outings)
		
		    <div class="row-fluid">
		    	<div class="span4">
					#parse('includes/outing.vm')	
		    	</div>
				
				<div class="span5">	
					<select class="availabilityDropdown" id="${outing.id}">
						<option value="">TBA</option>		
						#foreach($option in $availabilityOptions)
							#set($selected = '')
							#if ($outing.availability == $option.label) 
								#set($selected = 'SELECTED')
							#end
							<option value="$option.label" $selected>$option.label</option>	
						#end
					</select>
				</div>
				<div class="span1">										
					#if ($outing.availability) 						
						<span id="currentAvailability${outing.id}" class="label label-info">
							$outing.availability 
						</span>				
					#else
		 				<span id="currentAvailability${outing.id}">
		 					TBA
		 				</span>
					#end
				</div>
		    </div>
		#end
		</form>
		<hr>
	</div>
</div>
</div>

<script>
	$('.availabilityDropdown').change(function() {
    	outingId = $(this).attr('id');
    	newAvailability = $(this).val();    						
    	$.post("$urlBuilder.applicationUrl('/availability/ajax')", { outing: outingId, availability: newAvailability },
    	function(data) {
    		if (data.availability) {
	    		$("#currentAvailability" + outingId).attr('class', 'label label-info');
				$("#currentAvailability" + outingId).text(data.availability);
	    	} else {
	    		$("#currentAvailability" + outingId).attr('class', null);
	    		$("#currentAvailability" + outingId).text('TBA');	    			    		
	    	}
		});
  	});
</script>