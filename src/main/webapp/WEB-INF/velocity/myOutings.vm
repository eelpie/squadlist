#parse('includes/head.vm')
#navTabs('My outings')

<div class="row">

	#outingsNav('/')
	
	<div class="span9">
		<h3>My outings</h3>
		
		<form>
		#foreach($outing in $outings)
		
		    <div class="row">
		    	<div class="span3">
					#parse('includes/outing.vm')	
		    	</div>
				
				<div class="span3">	
					<select class="availabilityDropdown" id="${outing.id}">
						<option value="">TBA</option>		
						#foreach($option in $availabilityOptions)
							#set($selected = '')
							#if ($outing.availability == $option.label) 
								#set($selected = 'SELECTED')
							#end
							<option value="$option.label" $selected>$option.label</option>	
						#end
					</select>
				</div>
				<div class="span3">										
					#if ($outing.availability) 						
						<span id="currentAvailability${outing.id}" class="label label-info">
							$outing.availability 
						</span>				
					#else
		 				<span id="currentAvailability${outing.id}">
		 					TBA
		 				</span>
					#end
				</div>
		    </div>
		#end
		</form>
	</div>
</div>
</div>

<script>
	$('.availabilityDropdown').change(function() {
    	outingId = $(this).attr('id');
    	newAvailability = $(this).val();    						
    	$.post("$urlBuilder.applicationUrl('/availability/ajax')", { outing: outingId, availability: newAvailability },
    	function(data) {
			$("#currentAvailability" + outingId).text(data.availability);
		});
  	});
</script>