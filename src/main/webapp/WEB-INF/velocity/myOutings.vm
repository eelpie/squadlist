#parse('includes/head.vm')

<h3>My outings</h3>

#parse('includes/nav.vm')

<form>
#foreach($outing in $outings)

    <div class="row">
    	<div class="span4 offset1">
			#parse('includes/outing.vm')	
    	</div>
		
		<div class="span6">	
			<select class="availabilityDropdown" id="${outing.id}">
				<option value="">TBA</option>		
				#foreach($option in $availabilityOptions)
					#set($selected = '')
					#if ($outing.availability == $option) 
						#set($selected = 'SELECTED')
					#end
					<option value="$option" $selected>$option</option>	
				#end
			</select>
			
			<span id="currentAvailability${outing.id}">
				#if ($outing.availability) $outing.availability #else TBA #end
			</span>
		</div>
    </div>
#end
</form>

<script>
	$('.availabilityDropdown').change(function() {
    	outingId = $(this).attr('id');
    	newAvailability = $(this).val();
    	$.post("$urlBuilder.applicationUrl('/availability/ajax')", { outing: outingId, availability: newAvailability },
    	function(data) {
			$("#currentAvailability" + outingId).html(newAvailability);
		});
  	});
</script>